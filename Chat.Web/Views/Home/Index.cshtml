@{
    ViewData["Title"] = "Home Page";
}

@section Scripts
{
    <script src="~/lib/microsoft-signalr/signalr.min.js"></script>
    <script type="text/javascript">
        
       $(document).ready(()=> {
                    
            const connection = new signalR
            .HubConnectionBuilder()
            .configureLogging(signalR.LogLevel.Debug)
            .withUrl("https://localhost:7208/myhub")
            .withAutomaticReconnect([1000, 1000, 3000, 10000]) // tekrar bağlanmayı deneme süreleri. // default: 0, 2, 10, 30
            .build();

            async function start() {
                try {
                    await connection.start();
                    console.log("SignalR Connected.");
                } catch (err) {
                    console.log(err);
                    setTimeout(start, 5000);
                }
            };

            connection.onclose(async () => {
                await start();
            });

            start();
            
            setInterval(()=> {
                $("#connectionStatus").text(connection.state)
            }, 1000);
            
            
            $("#btnSave").click(()=> {
                var value = $("#txtName").val();
                connection.invoke("SendName", value).catch((err) => console.log(err));
            });

            connection.on("ReceiveName", (name) => {
                $("#names").append(`<li class="list-group-item">${name}</li>`);
                $("#txtName").text();
            });
       });

    </script>

}

<div class="text-center">
    <br/>
    <h1 id="connectionStatus"></h1>
    <br/>
    <input id="txtName"/>
    <button id="btnSave">İsim Kaydet</button>
    <hr/>

</div>
<ul class="list-group" id="names">

</ul>